---
#####################
### NON - SECRETS ###
#####################

###
### DEFINED - Org identity related
### 

iac__root_domain: "{{ u_vault_iac__root_domain }}" # https://crt.sh/?q={{ iac__root_domain }}
iac__github_org: "{{ u_vault_iac__github_org }}"

listmonk__site_name: "{{ u_vault_listmonk__site_name }}"

###
### EXTERNAL
### 

# CF Zero Trust
iac__cloudflare__zero_trust__team_name: "{{ u_vault_iac__cloudflare__zero_trust__team_name }}" # see https://one.dash.cloudflare.com/${accountId}/settings/custom_pages#TeamDomain

# ArgoCD - Github App
argocd__github_app__installation_id: "{{ u_vault_argocd__github_app__installation_id }}" #Â to get it, go to GH > [Org Profile] > Settings > Github Apps > [Select the App] > [see URL]
argocd__github_app__app_id: "{{ u_vault_argocd__github_app__app_id }}"

# Github ARC - Github App
github_arc__github_app__installation_id: "{{ u_vault_github_arc__github_app__installation_id }}"
github_arc__github_app__app_id: "{{ u_vault_github_arc__github_app__app_id }}"

## SENTRY ###
# SETTINGS FOR Github App (loosely based on https://docs.sentry.io/organization/integrations/source-code-mgmt/github/)
# Github App Name: <Whatever unique>
# Homepage URL: https://sentry.{{ iac__root_domain }}
# Callback URL: https://sentry.{{ iac__root_domain }}/auth/sso/
# Request user authorization (OAuth) during installation: CHECKED
# Webhook URL: https://sentry.{{ iac__root_domain }}/extensions/github/webhook/
# Webhook Secret: 'openssl rand -base64 500 | tr -dc 'a-zA-Z0-9' | fold -w 64 | head -n 1'
# Event Subscriptions:
# - Pull request
# - Push
# Permissions:
#   AccountPermissions:
#     - Email addresses: RO
#   OrganizationPermissions:
#     - Members: RO
#   RepositoryPermissions:
#     - Administration: RO
#     - Contents: RO
#     - Issues: RW
#     - Metadata: RO
#     - Pull Requests: RW
#     - Webhooks: RW
sentry__github_appid: "{{ u_vault_sentry__github_appid }}"
sentry__github_appname: "{{ u_vault_sentry__github_appname }}"

#################
### SECRETS ! ###
#################

# https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html#keep-vaulted-variables-safely-visible
# requires an encrypted file named "vault"
# "ansible-vault encrypt ansible/inventories/production/group_vars/all/vault"
# "ansible-vault decrypt ansible/inventories/production/group_vars/all/vault"

###
### DEFINED
### 

# password for postmaster@{{ iac__root_domain }}
iac__postmaster_password: "{{ vault_iac__postmaster_password }}"

# password for donotreply@{{ iac__root_domain }}
iac__donotreply_password: "{{ vault_iac__donotreply_password }}"

#
openldap_stack__ldap_admin_pwd: "{{ vault_openldap_stack__ldap_admin_pwd }}"
openldap_stack__lam_password: "{{ vault_openldap_stack__lam_password }}"
openldap_stack__ssp_keyphrase: "{{ vault_openldap_stack__ssp_keyphrase }}"

# password for "admin" user on Hashicorp Vault
hc_vault__admin_password: "{{ vault_hc_vault__admin_password }}"

#
prometheus_stack__grafana_admin_pwd: "{{ vault_prometheus_stack__grafana_admin_pwd }}"

#
listmonk__admin_password: "{{ vault_listmonk__admin_password }}"

#
matomo__admin_password: "{{ vault_matomo__admin_password }}"

# 12 characters min
portainer__admin_password: "{{ vault_portainer__admin_password }}"

#
sentry__usermail_password: "{{ vault_sentry__usermail_password }}"

#
harbor__registry_password: "{{ vault_harbor__registry_password }}"
harbor__admin_password: "{{ vault_harbor__admin_password }}"
harbor__secret_key: "{{ vault_harbor__secret_key }}" # must be 16 characters exactly !

###
### EXTERNAL
### 

# https://cert-manager.io/docs/configuration/acme/dns01/cloudflare/#api-tokens
# https://kubernetes-sigs.github.io/external-dns/v0.12.1/tutorials/cloudflare/#creating-cloudflare-credentials
# https://github.com/BojanZelic/cloudflare-zero-trust-operator?tab=readme-ov-file#token-permissions
# @below Cloudflare token config template (https://dash.cloudflare.com/profile/api-tokens)
## Authorizations: 
# Zone - DNS - Edit
# Zone - Zone - Read
# Access - Service Tokens - Edit
# Access - Organizations, Identity Providers, and Groups - Edit
# Access - Apps and Policies - Edit
## Zones: 
# Include - Specific Zone - {{ iac__root_domain }}
iac__cloudflare__account_id: "{{ vault_iac__cloudflare__account_id }}"
iac__cloudflare__zone_id: "{{ vault_iac__cloudflare__zone_id }}"
iac__cloudflare__api_token: "{{ vault_iac__cloudflare__api_token }}"

# PLEASE CONFIGURE CLOUDFLARE FOR "Full (Strict)" in CloudFlare dashboard > /ssl-tls/configuration
# then generate a cert in CloudFlare dashboard > /ssl-tls/origin/certificate-form
iac__cloudflare__origin_ca__cert: "{{ vault_iac__cloudflare__origin_ca__cert }}"
iac__cloudflare__origin_ca__priv_key: "{{ vault_iac__cloudflare__origin_ca__priv_key }}"

#
argocd__admin_password: "{{ vault_argocd__admin_password }}"

### MAKE SURE GITHUB APP HAS BELOW RIGHTS:
# +> https://argo-cd.readthedocs.io/en/stable/user-guide/private-repositories/#github-app-credential
# +> https://argo-cd.readthedocs.io/en/stable/operator-manual/notifications/services/github/
#
# GitHub App name: Argo CD On-Premise
# Homepage URL: https://argocd.{{ iac__root_domain }}
# No Webhook
# No Token expiry
# PERMS:
# > Repository permissions > Commit statuses: RW
# > Repository permissions > Content:         RO
# > Repository permissions > Deployments:     RW
# > Repository permissions > Metadata:        RO
# > Repository permissions > Pull Requests:   RW


argocd__github_app__priv_key: "{{ vault_argocd__github_app__priv_key }}"

# https://argo-cd.readthedocs.io/en/latest/operator-manual/webhook/
argocd__github_webhook_secret: "{{ vault_argocd__github_webhook_secret }}"

### MAKE SURE GITHUB APP HAS BELOW RIGHTS
# https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners-with-actions-runner-controller/authenticating-to-the-github-api
github_arc__github_app__priv_key: "{{ vault_github_arc__github_app__priv_key }}"

# ZeroSSL (if used in k8s__cert_manager)
cert_manager__zerossl__eab_kid: "{{ u_vault_cert_manager__zerossl__eab_kid }}"
cert_manager__zerossl__eab_hmac_key: "{{ vault_cert_manager__zerossl__eab_hmac_key }}"

# minimum 8 chars
minio__tenant_password: "{{ vault_minio__tenant_password }}"
minio__secret_access_key: "{{ minio__tenant_password }}"

#
sentry__github_clientId: "{{ vault_sentry__github_clientId }}"
sentry__github_clientSecret: "{{ vault_sentry__github_clientSecret }}"
sentry__github_privateKey: "{{ vault_sentry__github_privateKey }}"
sentry__github_webhookSecret: "{{ vault_sentry__github_webhookSecret }}"
