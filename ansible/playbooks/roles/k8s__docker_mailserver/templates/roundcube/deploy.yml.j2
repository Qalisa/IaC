apiVersion: apps/v1
kind: Deployment
metadata:
  name: roundcube
  namespace: "{{ docker_mailserver__namespace }}"
spec:
  revisionHistoryLimit: 0
  selector:
    matchLabels:
      app: roundcube
  template:
    metadata:
      labels:
        app: roundcube
    spec:
      containers:
        - name: roundcubemail
          image: roundcube/roundcubemail:latest
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: data
              mountPath: /var/www/html
              subPath: www
              readOnly: false
            - name: data
              mountPath: /var/roundcube/db
              subPath: db
              readOnly: false
            # https://hub.docker.com/r/roundcube/roundcubemail/
            - name: config
              mountPath: /var/roundcube/config/more.inc.php
              subPath: more.inc.php
              readOnly: true
          ports:
            - name: app
              containerPort: 80
              protocol: TCP
          envFrom:
            - configMapRef:
                name: roundcube
      restartPolicy: Always
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: roundcube
        - name: config
          configMap:
            name: roundcube.more.config