---
- name: Retrieve file
  ansible.builtin.get_url:
    url: https://github.com/reddec/ingress-dashboard/releases/latest/download/ingress-dashboard.yaml
    dest: /tmp/ingress-dashboard.yaml
    mode: "0775"

- name: Create deployment
  kubernetes.core.k8s:
    src: /tmp/ingress-dashboard.yaml

- name: Install Zero-Trust configuration
  tags: [zto-app]
  kubernetes.core.k8s:
    template:
      - path: templates/caa.yml.j2

- name: Install
  kubernetes.core.k8s:
    template:
      - path: templates/ingress.yml.j2
      - path: templates/deploy-patch.yml.j2
      - path: templates/config.yml.j2

- name: Install policies
  tags: [policies]
  kubernetes.core.k8s:
    src: src/cp-autorestart-ingress-dashboard.yml
